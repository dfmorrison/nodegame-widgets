/**
 * # Widget
 * Copyright(c) 2014 Stefano Balietti
 * MIT Licensed
 *
 * Prototype of a widget class.
 *
 * The methods of the prototype will be injected in every new widget, if missing.
 * Properties: _headingDiv_, _bodyDiv_, and _footer_ might be automatically
 * added as well, depending on widget configuration.
 *
 * ---
 */
(function(e){"use strict";function t(){}e.Widget=t,t.prototype.dependencies={},t.prototype.listeners=function(){},t.prototype.getValues=function(){},t.prototype.append=function(){},t.prototype.init=function(){},t.prototype.getAllValues=function(){},t.prototype.highlight=function(){},t.prototype.destroy=function(){},t.prototype.setTitle=function(e){if(!this.panelDiv)throw new Error("Widget.setTitle: panelDiv is missing.");e?(this.headingDiv||(this.headingDiv=W.addDiv(this.panelDiv,undefined,{className:"panel-heading"}),this.panelDiv.insertBefore(this.headingDiv,this.bodyDiv)),W.isElement(e)?(this.headingDiv.innerHTML="",this.headingDiv.appendChild(e)):this.headingDiv.innerHTML=e):this.headingDiv&&(this.panelDiv.removeChild(this.headingDiv),delete this.headingDiv)},t.prototype.setFooter=function(e){if(!this.panelDiv)throw new Error("Widget.setFooter: panelDiv is missing.");e?(this.footerDiv||(this.footerDiv=W.addDiv(this.panelDiv,undefined,{className:"panel-footer"})),W.isElement(e)?(this.footerDiv.innerHTML="",this.footerDiv.appendChild(e)):this.footerDiv.innerHTML=e):this.footerDiv&&(this.panelDiv.removeChild(this.footerDiv),delete this.footerDiv)},t.prototype.setContext=function(e){W.removeClass(this.panelDiv,"panel-[a-z]*"),W.addClass(this.panelDiv,"panel-"+e)}})("undefined"!=typeof node?node:module.parent.exports.node),function(e,t){"use strict";function r(){this.widgets={},this.instances=[]}function i(e,t){return W.addDiv(e,undefined,t.attributes)}function s(e,t,n){if(!e||!t||!n)return;e.panelDiv[t]=function(){n.call(e)}}function o(e,t){var r,i,o;if(!e||!t)return;i=!1,r=["onclick","onfocus","onblur","onchange","onsubmit","onload","onunload","onmouseover"];for(o in e)e.hasOwnProperty(o)&&(i=n.in_array(o,r),i&&"function"==typeof e[o]&&s(t,o,e[o]))}function u(e,n){var r=e.name||e.id;t.err(n+" not found. "+r+" cannot be loaded.")}var n=t.JSUS;r.prototype.register=function(e,r){var i;if("string"!=typeof e)throw new TypeError("Widgets.register: name must be string.");if("function"!=typeof r)throw new TypeError("Widgets.register: w must be function.");return n.mixout(r.prototype,new t.Widget),this.widgets[e]=r,this.widgets[e]},r.prototype.get=function(e,r){var i,s,u;if("string"!=typeof e)throw new TypeError("Widgets.get: w_str must be string.");if(r&&"object"!=typeof r)throw new TypeError("Widgets.get: options must be object or undefined.");u=this,r=r||{},i=n.getNestedValue(e,this.widgets);if(!i)throw new Error("Widgets.get: "+e+" not found.");t.info("registering "+i.name+" v."+i.version);if(!this.checkDependencies(i))throw new Error("Widgets.get: "+e+" has unmet dependecies.");return n.mixout(r,n.clone(i.defaults)),s=new i(r),s.defaults=r,s.title=i.title,s.footer=i.footer,s.className=i.className,s.context=i.context,s.listeners.call(s),o(r,s),s},r.prototype.append=r.prototype.add=function(e,t,r){if("string"!=typeof e&&"object"!=typeof e)throw new TypeError("Widgets.append: w must be string or object.");if(t&&!n.isElement(t))throw new TypeError("Widgets.append: root must be HTMLElement or undefined.");if(r&&"object"!=typeof r)throw new TypeError("Widgets.append: options must be object or undefined.");return t=t||W.getFrameRoot()||document.body,r=r||{},"string"==typeof e&&(e=this.get(e,r)),e.panelDiv=i(t,{attributes:{className:["ng_widget","panel","panel-default",e.className]}}),e.title&&e.setTitle(e.title),e.bodyDiv=i(e.panelDiv,{attributes:{className:"panel-body"}}),e.footer&&e.setFooter(e.footer),e.context&&e.setContext(e.context),e.append(),this.instances.push(e),e},r.prototype.destroyAll=function(){var e,n;for(e in this.instances)if(this.instances.hasOwnProperty(e)){n=this.instances[e];try{n.destroy(),n.panelDiv.parentNode.removeChild(n.panelDiv)}catch(r){t.warn("Widgets.destroyAll: Error caught. "+r+".")}}this.instances=[]},r.prototype.checkDependencies=function(r,i){var s,o,a,f,l;if(!r.dependencies)return!0;s=[e,t,this.widgets,t.window],o=r.dependencies;for(a in o)if(o.hasOwnProperty(a)){f=!1;for(l=0;l<s.length;l++)if(n.getNestedValue(a,s[l])){f=!0;break}if(!f)return i||u(r,a),!1}return!0},t.widgets=new r}("undefined"!=typeof window?window:module.parent.exports.window,"undefined"!=typeof window?window.node:module.parent.exports.node)