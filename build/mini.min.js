
(function(e){function r(e){this.id=e.id,this.recipient=null,this.actionSel=null,this.targetSel=null,this.table=new n,this.fieldset={legend:"Send MSG"},this.init()}var t=node.GameMsg,n=node.window.Table;e.MsgBar=r,r.id="msgbar",r.name="Msg Bar",r.version="0.4",r.description="Send a nodeGame message to players",r.prototype.init=function(){var e=this,n=new t,r=0;for(var i in n)if(n.hasOwnProperty(i)){var s=this.id+"_"+i;this.table.add(i,0,r),this.table.add(node.window.getTextInput(s),1,r),i==="target"?(this.targetSel=node.window.getTargetSelector(this.id+"_targets"),this.table.add(this.targetSel,2,r),this.targetSel.onchange=function(){node.window.getElementById(e.id+"_target").value=e.targetSel.value}):i==="action"?(this.actionSel=node.window.getActionSelector(this.id+"_actions"),this.table.add(this.actionSel,2,r),this.actionSel.onchange=function(){node.window.getElementById(e.id+"_action").value=e.actionSel.value}):i==="to"&&(this.recipient=node.window.getRecipientSelector(this.id+"recipients"),this.table.add(this.recipient,2,r),this.recipient.onchange=function(){node.window.getElementById(e.id+"_to").value=e.recipient.value}),r++}this.table.parse()},r.prototype.append=function(e){var t=node.window.addButton(e),n=node.window.addButton(e,"stub","Add Stub"),r=this;return t.onclick=function(){var e=r.parse();node.node.gsc.send(e)},n.onclick=function(){r.addStub()},e.appendChild(this.table.table),this.root=e,e},r.prototype.getRoot=function(){return this.root},r.prototype.listeners=function(){var e=this;node.onPLIST(function(t){node.window.populateRecipientSelector(e.recipient,t.data)})},r.prototype.parse=function(){var e={},n=this,r=null,i=null;return this.table.forEach(function(t){if(t.x===0)r=t.content,e[r]="";else if(t.x===1){i=t.content.value;if(r==="state"||r==="data")try{i=JSON.parse(t.content.value)}catch(n){i=t.content.value}e[r]=i}}),console.log(e),new t(e)},r.prototype.addStub=function(){node.window.getElementById(this.id+"_from").value=node.player?node.player.id:"undefined",node.window.getElementById(this.id+"_to").value=this.recipient.value,node.window.getElementById(this.id+"_forward").value=0,node.window.getElementById(this.id+"_reliable").value=1,node.window.getElementById(this.id+"_priority").value=0,node.gsc&&node.gsc.session&&(node.window.getElementById(this.id+"_session").value=node.gsc.session),node.window.getElementById(this.id+"_state").value=JSON.stringify(node.state),node.window.getElementById(this.id+"_action").value=this.actionSel.value,node.window.getElementById(this.id+"_target").value=this.targetSel.value}})(node.window.widgets),function(e){function t(e){this.id=e.id,this.gameLoop=node.game.gameLoop,this.fieldset={legend:"State"},this.root=null,this.table=new Table}e.VisualState=t,GameState=node.GameState,JSUS=node.JSUS,Table=node.window.Table,t.id="visualstate",t.name="Visual State",t.version="0.2.1",t.description="Visually display current, previous and next state of the game.",t.dependencies={JSUS:{},Table:{}},t.prototype.init=function(){},t.prototype.getRoot=function(){return this.root},t.prototype.append=function(e,t){var n=this,r=this.id+"_";return e.appendChild(this.table.table),this.writeState(),e},t.prototype.listeners=function(){var e=this;node.on("STATECHANGE",function(){e.writeState()})},t.prototype.writeState=function(){var e=!1,t=!1,n=!1,r="-";node.game&&node.game.state?(e=this.gameLoop.getName(node.game.state)||r,t=this.gameLoop.getName(node.game.previous())||r,n=this.gameLoop.getName(node.game.next())||r):(e="Uninitialized",t=r,n=r),this.table.clear(!0),this.table.addRow(["Previous: ",t]),this.table.addRow(["Current: ",e]),this.table.addRow(["Next: ",n]);var i=this.table.select("y","=",2);i.addClass("strong"),i.select("x","=",0).addClass("underline"),this.table.parse()}}(node.window.widgets)